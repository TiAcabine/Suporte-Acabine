<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <title>Suporte TI - ACabine Materiais El√©tricos</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">    
                <img src="img/acabine (2)_waifu2x_photo_noise3_scale.png" alt="Logo ACabine" class="logo-image">
            </div>
            <p>ABRA SEU CHAMADO ‚¨áÔ∏è</p>
        </div>
        
        <div class="form-container">
            <div class="success-message" id="successMessage">
                <span class="icon">‚úÖ</span>
                Sua solicita√ß√£o foi enviada com sucesso! Nossa equipe de TI entrar√° em contato em breve.
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Enviando solicita√ß√£o...</p>
            </div>
            
            <form id="supportForm">
                <div class="form-group">
                    <label for="nome">
                        <span class="icon">üë§</span> Nome Completo
                    </label>
                    <input type="text" id="nome" name="nome" required placeholder="Digite seu nome completo">
                </div>
                
                <div class="form-group">
                    <label for="setor">
                        <span class="icon">üè¢</span> Setor
                    </label>
                    <select id="setor" name="setor" required>
                        <option value="">Selecione seu setor</option>
                        <option value="Vendas">Vendas</option>
                        <option value="Financeiro">Financeiro</option>
                        <option value="Compras">Compras</option>
                        <option value="Expedi√ß√£o">Expedi√ß√£o</option>
                        <option value="RH">Recursos Humanos</option>
                        <option value="Presid√™ncia">Presid√™ncia</option>
                        <option value="Diretoria">Diretoria</option>
                        <option value="Portaria">Portaria</option>
                        <option value="Oficina">Oficina</option>
                        <option value="TI">Tecnologia da Informa√ß√£o</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="email">
                        <span class="icon">üìß</span> E-mail
                    </label>
                    <input type="email" id="email" name="email" required placeholder="Seu email">
                </div>
                
                <div class="form-group">
                    <label for="telefone">
                        <span class="icon">üì±</span> Telefone/Ramal
                    </label>
                    <input type="tel" id="telefone" name="telefone" placeholder="(11) 99999-9999 ou Ramal: 123">
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="icon">‚ö†Ô∏è</span> Prioridade
                    </label>
                    <div class="priority-group">
                        <div class="priority-option">
                            <input type="radio" name="prioridade" value="Baixa" id="baixa" class="priority-baixa" checked>
                            <label for="baixa" class="priority-label">Baixa</label>
                        </div>
                        <div class="priority-option">
                            <input type="radio" name="prioridade" value="M√©dia" id="media" class="priority-media">
                            <label for="media" class="priority-label">M√©dia</label>
                        </div>
                        <div class="priority-option">
                            <input type="radio" name="prioridade" value="Alta" id="alta" class="priority-alta">
                            <label for="alta" class="priority-label">Alta</label>
                        </div>
                    </div>
                </div>
            </br>
                <div class="form-group">
                    <label>
                        <span class="icon">‚öôÔ∏è</span> Problema com:
                    </label>
                    <div class="priority-group">
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Computador" id="computador" class="priority-computador" checked>
                            <label for="computador" class="priority-label">Computador</label>
                        </div>
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Hardware" id="hardware" class="priority-hardware">
                            <label for="hardware" class="priority-label">Hardware</label>
                        </div>
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Sistema" id="sistema" class="priority-sistema">
                            <label for="sistema" class="priority-label">Sistema</label>
                        </div>
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Outros" id="outros" class="priority-outros">
                            <label for="outros" class="priority-label">Outros</label>
                        </div>
                    </div>    
                </div>
                
                <div class="form-group">
                    <label for="problema">
                        <span class="icon">üîß</span> Descri√ß√£o do Problema
                    </label>
                    <textarea id="problema" name="problema" required placeholder="Descreva detalhadamente o problema que est√° enfrentando..."></textarea>
                </div>
                
                <!-- NOVA SE√á√ÉO PARA UPLOAD DE IMAGENS -->
                <div class="form-group">
                    <label>
                        <span class="icon">üì∑</span> Anexar Imagens (Opcional)
                    </label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <input type="file" id="imageInput" name="images" class="file-upload-input" multiple accept="image/*">
                        <div class="file-upload-text">
                            <span class="icon">üìÅ</span>
                            Clique aqui ou arraste as imagens<br>
                            <small>Formatos aceitos: JPG, PNG, GIF (m√°x. 5MB cada)</small>
                        </div>
                    </div>
                    <div class="image-preview" id="imagePreview"></div>
                </div>
                
                <button type="submit" class="submit-btn">
                    <span class="icon">üì®</span> Enviar Solicita√ß√£o
                </button>
            </form>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        // Inicializar EmailJS (SUBSTITUA PELA SUA PUBLIC KEY)
        emailjs.init("ar-62IWxTL59uCVf_");
        
        // Array para armazenar as imagens selecionadas
        let selectedImages = [];
        
        // Elementos do upload de imagens
        const fileUploadArea = document.getElementById('fileUploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        
        // Event listeners para drag and drop
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });
        
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });
        
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            handleFileSelection(files);
        });
        
        // Event listener para sele√ß√£o de arquivos
        imageInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFileSelection(files);
        });
        
        // Fun√ß√£o para lidar com a sele√ß√£o de arquivos
        function handleFileSelection(files) {
            files.forEach(file => {
                // Validar tipo de arquivo
                if (!file.type.startsWith('image/')) {
                    alert(`${file.name} n√£o √© um arquivo de imagem v√°lido.`);
                    return;
                }
                
                // Validar tamanho do arquivo (5MB m√°ximo)
                if (file.size > 5 * 1024 * 1024) {
                    alert(`${file.name} √© muito grande. M√°ximo 5MB por imagem.`);
                    return;
                }
                
                // Verificar se a imagem j√° foi selecionada
                if (selectedImages.some(img => img.name === file.name && img.size === file.size)) {
                    alert(`${file.name} j√° foi selecionada.`);
                    return;
                }
                
                // Adicionar imagem ao array
                selectedImages.push(file);
                
                // Criar preview da imagem
                createImagePreview(file, selectedImages.length - 1);
            });
        }
        
        // Fun√ß√£o para criar preview da imagem
        function createImagePreview(file, index) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${e.target.result}" alt="Preview">
                    <button type="button" class="remove-image" onclick="removeImage(${index})">√ó</button>
                    <div class="file-info">${file.name}</div>
                `;
                imagePreview.appendChild(imageItem);
            };
            reader.readAsDataURL(file);
        }
        
        // Fun√ß√£o para remover imagem
        function removeImage(index) {
            selectedImages.splice(index, 1);
            updateImagePreview();
        }
        
        // Fun√ß√£o para atualizar preview das imagens
        function updateImagePreview() {
            imagePreview.innerHTML = '';
            selectedImages.forEach((file, index) => {
                createImagePreview(file, index);
            });
        }
        
        // Fun√ß√£o para converter imagem para base64
        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Fun√ß√£o para upload de imagens para servi√ßo gratuito
        async function uploadImageToService(file) {
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                // Usando ImgBB como servi√ßo gratuito de hospedagem de imagens
                const response = await fetch('https://api.imgbb.com/1/upload?key=YOUR_IMGBB_API_KEY', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                return data.data.url;
            } catch (error) {
                console.error('Erro no upload da imagem:', error);
                return null;
            }
        }
        
        // Event listener do formul√°rio principal
        document.getElementById('supportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Verificar se pelo menos um equipamento foi selecionado
            const equipamentos = document.querySelectorAll('input[name="equipamento"]:checked');
            if (equipamentos.length === 0) {
                alert('Por favor, selecione pelo menos um tipo de equipamento.');
                return;
            }
            
            // Coletar todos os equipamentos selecionados
            const equipamentosSelecionados = Array.from(equipamentos).map(eq => eq.value);
            
            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('supportForm').style.display = 'none';
            
            try {
                // Preparar informa√ß√µes das imagens
                let listaImagens = '';
                let imagensInfo = '';
                
                if (selectedImages.length > 0) {
                    // Converter imagens para base64 e incluir no corpo do email
                    for (let i = 0; i < selectedImages.length; i++) {
                        const base64 = await convertToBase64(selectedImages[i]);
                        const fileSize = (selectedImages[i].size / 1024).toFixed(2);
                        
                        listaImagens += `${i + 1}. ${selectedImages[i].name} (${fileSize} KB)\n`;
                        
                        // Adicionar imagem como dados base64 no corpo do email
                        imagensInfo += `\n\n--- IMAGEM ${i + 1}: ${selectedImages[i].name} ---\n`;
                        imagensInfo += `Tamanho: ${fileSize} KB\n`;
                        imagensInfo += `Dados da imagem (Base64):\n${base64}\n`;
                        imagensInfo += `--- FIM DA IMAGEM ${i + 1} ---\n`;
                    }
                } else {
                    listaImagens = 'Nenhuma imagem anexada';
                }
                
                // Coletar dados do formul√°rio
                const templateParams = {
                    nome: document.getElementById('nome').value,
                    setor: document.getElementById('setor').value,
                    email: document.getElementById('email').value,
                    telefone: document.getElementById('telefone').value,
                    prioridade: document.querySelector('input[name="prioridade"]:checked').value,
                    equipamento: equipamentosSelecionados.join(', '),
                    problema: document.getElementById('problema').value + imagensInfo,
                    to_email: 'chamados@acabine.com.br',
                    data_hora: new Date().toLocaleString('pt-BR'),
                    imagens_lista: listaImagens
                };
                
                console.log('Equipamentos selecionados:', equipamentosSelecionados);
                console.log('N√∫mero de imagens:', selectedImages.length);
                
                // Enviar email usando EmailJS
                const response = await emailjs.send('service_jcvbhsr', 'template_z6uag69', templateParams);
                
                console.log('Email enviado com sucesso!', response.status, response.text);
                
                // Esconder loading
                document.getElementById('loading').style.display = 'none';
                
                // Mostrar mensagem de sucesso
                document.getElementById('successMessage').style.display = 'block';
                
                // Resetar formul√°rio ap√≥s 3 segundos
                setTimeout(() => {
                    document.getElementById('supportForm').reset();
                    selectedImages = [];
                    imagePreview.innerHTML = '';
                    document.getElementById('successMessage').style.display = 'none';
                    document.getElementById('supportForm').style.display = 'block';
                }, 3000);
                
            } catch (error) {
                console.log('Erro ao enviar email:', error);
                
                // Esconder loading
                document.getElementById('loading').style.display = 'none';
                
                // Mostrar erro
                alert('Erro ao enviar solicita√ß√£o. Tente novamente ou contate o TI diretamente.');
                
                // Mostrar formul√°rio novamente
                document.getElementById('supportForm').style.display = 'block';
            }
        });

        // M√°scara para telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 10) {
                value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            }
            e.target.value = value;
        });
    </script>
</body>
</html>
