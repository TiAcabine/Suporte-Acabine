<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <title>Suporte TI - ACabine Materiais El√©tricos</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">    
                <img src="img/acabine (2)_waifu2x_photo_noise3_scale.png" alt="Logo ACabine" class="logo-image">
            </div>
            <p>ABRA SEU CHAMADO ‚¨áÔ∏è</p>
        </div>
        
        <div class="form-container">
            <div class="success-message" id="successMessage">
                <span class="icon">‚úÖ</span>
                Sua solicita√ß√£o foi enviada com sucesso! Nossa equipe de TI entrar√° em contato em breve.
            </div>

            <div class="error-message" id="errorMessage">
                <span class="icon">‚ùå</span>
                <span id="errorText">Erro ao enviar solicita√ß√£o. Tente novamente.</span>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Enviando solicita√ß√£o...</p>
            </div>
            
            <form id="supportForm">
                <div class="form-group">
                    <label for="nome">
                        <span class="icon">üë§</span> Nome Completo
                    </label>
                    <input type="text" id="nome" name="nome" required placeholder="Digite seu nome completo">
                    <div class="validation-error" id="nome-error">Por favor, digite seu nome completo</div>
                </div>
                
                <div class="form-group">
                    <label for="setor">
                        <span class="icon">üè¢</span> Setor
                    </label>
                    <select id="setor" name="setor" required>
                        <option value="">Selecione seu setor</option>
                        <option value="Vendas">Vendas</option>
                        <option value="Financeiro">Financeiro</option>
                        <option value="Compras">Compras</option>
                        <option value="Expedi√ß√£o">Expedi√ß√£o</option>
                        <option value="RH">Recursos Humanos</option>
                        <option value="Presid√™ncia">Presid√™ncia</option>
                        <option value="Diretoria">Diretoria</option>
                        <option value="Portaria">Portaria</option>
                        <option value="Oficina">Oficina</option>
                        <option value="TI">Tecnologia da Informa√ß√£o</option>
                    </select>
                    <div class="validation-error" id="setor-error">Por favor, selecione seu setor</div>
                </div>
                
                <div class="form-group">
                    <label for="email">
                        <span class="icon">üìß</span> E-mail
                    </label>
                    <input type="email" id="email" name="email" required placeholder="Seu email">
                    <div class="validation-error" id="email-error">Por favor, digite um email v√°lido</div>
                </div>
                
                <div class="form-group">
                    <label for="telefone">
                        <span class="icon">üì±</span> Telefone/Ramal
                    </label>
                    <input type="tel" id="telefone" name="telefone" placeholder="(11) 99999-9999 ou Ramal: 123">
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="icon">‚ö†Ô∏è</span> Prioridade
                    </label>
                    <div class="priority-group">
                        <div class="priority-option">
                            <input type="radio" name="prioridade" value="Baixa" id="baixa" class="priority-baixa" checked>
                            <label for="baixa" class="priority-label">Baixa</label>
                        </div>
                        <div class="priority-option">
                            <input type="radio" name="prioridade" value="M√©dia" id="media" class="priority-media">
                            <label for="media" class="priority-label">M√©dia</label>
                        </div>
                        <div class="priority-option">
                            <input type="radio" name="prioridade" value="Alta" id="alta" class="priority-alta">
                            <label for="alta" class="priority-label">Alta</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span class="icon">‚öôÔ∏è</span> Problema com:
                    </label>
                    <div class="priority-group">
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Computador" id="computador" class="priority-computador">
                            <label for="computador" class="priority-label">Computador</label>
                        </div>
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Hardware" id="hardware" class="priority-hardware">
                            <label for="hardware" class="priority-label">Hardware</label>
                        </div>
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Sistema" id="sistema" class="priority-sistema">
                            <label for="sistema" class="priority-label">Sistema</label>
                        </div>
                        <div class="priority-option">
                            <input type="checkbox" name="equipamento" value="Outros" id="outros" class="priority-outros">
                            <label for="outros" class="priority-label">Outros</label>
                        </div>
                    </div>    
                    <div class="validation-error" id="equipamento-error">Por favor, selecione pelo menos um tipo de equipamento</div>
                </div>
                
                <div class="form-group">
                    <label for="problema">
                        <span class="icon">üîß</span> Descri√ß√£o do Problema
                    </label>
                    <textarea id="problema" name="problema" required placeholder="Descreva detalhadamente o problema que est√° enfrentando..."></textarea>
                    <div class="validation-error" id="problema-error">Por favor, descreva o problema</div>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span class="icon">üì®</span> Enviar Solicita√ß√£o
                </button>
            </form>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        // Inicializar EmailJS com verifica√ß√£o
        try {
            emailjs.init("ar-62IWxTL59uCVf_");
            console.log("EmailJS inicializado com sucesso");
        } catch (error) {
            console.error("Erro ao inicializar EmailJS:", error);
        }
        
        // Fun√ß√£o para validar email
        function validarEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        // Fun√ß√£o para mostrar erro de valida√ß√£o
        function mostrarErroValidacao(campo, mostrar = true) {
            const formGroup = document.getElementById(campo).closest('.form-group');
            const errorDiv = document.getElementById(campo + '-error');
            
            if (mostrar) {
                formGroup.classList.add('error');
                errorDiv.style.display = 'block';
            } else {
                formGroup.classList.remove('error');
                errorDiv.style.display = 'none';
            }
        }

        // Fun√ß√£o para validar formul√°rio
        function validarFormulario() {
            let valido = true;
            
            // Validar nome
            const nome = document.getElementById('nome').value.trim();
            if (!nome || nome.length < 3) {
                mostrarErroValidacao('nome', true);
                valido = false;
            } else {
                mostrarErroValidacao('nome', false);
            }
            
            // Validar setor
            const setor = document.getElementById('setor').value;
            if (!setor) {
                mostrarErroValidacao('setor', true);
                valido = false;
            } else {
                mostrarErroValidacao('setor', false);
            }
            
            // Validar email
            const email = document.getElementById('email').value.trim();
            if (!email || !validarEmail(email)) {
                mostrarErroValidacao('email', true);
                valido = false;
            } else {
                mostrarErroValidacao('email', false);
            }
            
            // Validar equipamentos selecionados
            const equipamentos = document.querySelectorAll('input[name="equipamento"]:checked');
            if (equipamentos.length === 0) {
                document.getElementById('equipamento-error').style.display = 'block';
                valido = false;
            } else {
                document.getElementById('equipamento-error').style.display = 'none';
            }
            
            // Validar descri√ß√£o do problema
            const problema = document.getElementById('problema').value.trim();
            if (!problema || problema.length < 10) {
                mostrarErroValidacao('problema', true);
                valido = false;
            } else {
                mostrarErroValidacao('problema', false);
            }
            
            return valido;
        }

        // Event listener para o formul√°rio
        document.getElementById('supportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar formul√°rio
            if (!validarFormulario()) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorText').textContent = 'Por favor, corrija os erros no formul√°rio.';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 5000);
                return;
            }

            // Esconder mensagens anteriores
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // Coletar equipamentos selecionados
            const equipamentos = document.querySelectorAll('input[name="equipamento"]:checked');
            const equipamentosSelecionados = Array.from(equipamentos).map(eq => eq.value);
            
            // Mostrar loading e desabilitar bot√£o
            document.getElementById('loading').style.display = 'block';
            document.getElementById('supportForm').style.display = 'none';
            document.getElementById('submitBtn').disabled = true;
            
            // Coletar dados do formul√°rio
            const templateParams = {
                from_name: document.getElementById('nome').value.trim(),
                from_email: document.getElementById('email').value.trim(),
                setor: document.getElementById('setor').value,
                telefone: document.getElementById('telefone').value.trim() || 'N√£o informado',
                prioridade: document.querySelector('input[name="prioridade"]:checked').value,
                equipamento: equipamentosSelecionados.join(', '),
                message: document.getElementById('problema').value.trim(),
                to_email: 'chamados@acabine.com.br',
                reply_to: document.getElementById('email').value.trim()
            };
            
            console.log('Enviando dados:', templateParams);
            console.log('Service ID:', 'service_o4vzhs9');
            console.log('Template ID:', 'template_z6uag69');
            
            // Verificar se EmailJS est√° dispon√≠vel
            if (typeof emailjs === 'undefined') {
                throw new Error('EmailJS n√£o carregado');
            }
            
            // Enviar email usando EmailJS com timeout
            const envioPromise = emailjs.send('service_o4vzhs9', 'template_z6uag69', templateParams);
            
            // Adicionar timeout de 30 segundos
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('Timeout - Verifique sua conex√£o')), 30000);
            });
            
            Promise.race([envioPromise, timeoutPromise])
                .then(function(response) {
                    console.log('Email enviado com sucesso!', response);
                    
                    // Esconder loading
                    document.getElementById('loading').style.display = 'none';
                    
                    // Mostrar mensagem de sucesso
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // Resetar formul√°rio ap√≥s 5 segundos
                    setTimeout(() => {
                        document.getElementById('supportForm').reset();
                        document.getElementById('successMessage').style.display = 'none';
                        document.getElementById('supportForm').style.display = 'block';
                        document.getElementById('submitBtn').disabled = false;
                        
                        // Resetar valida√ß√µes
                        document.querySelectorAll('.form-group').forEach(group => {
                            group.classList.remove('error');
                        });
                        document.querySelectorAll('.validation-error').forEach(error => {
                            error.style.display = 'none';
                        });
                        
                        // Reselecionar "Baixa" prioridade
                        document.getElementById('baixa').checked = true;
                    }, 5000);
                    
                })
                .catch(function(error) {
                    console.error('Erro completo:', error);
                    console.error('Tipo do erro:', typeof error);
                    console.error('Status:', error.status);
                    console.error('Text:', error.text);
                    
                    // Esconder loading
                    document.getElementById('loading').style.display = 'none';
                    
                    // Mostrar erro espec√≠fico
                    document.getElementById('errorMessage').style.display = 'block';
                    let errorText = '';
                    
                    if (error.message && error.message.includes('Timeout')) {
                        errorText = 'Conex√£o lenta. Verifique sua internet e tente novamente.';
                    } else if (error.status === 400 || error.text === 'Bad Request') {
                        errorText = 'Template do EmailJS inv√°lido. Contate o administrador.';
                    } else if (error.status === 401 || error.text === 'Unauthorized') {
                        errorText = 'Chave de API inv√°lida. Contate o administrador.';
                    } else if (error.status === 404) {
                        errorText = 'Servi√ßo EmailJS n√£o encontrado. Contate o administrador.';
                    } else if (error.status >= 500) {
                        errorText = 'Erro no servidor EmailJS. Tente novamente em alguns minutos.';
                    } else if (error.name === 'NetworkError' || !navigator.onLine) {
                        errorText = 'Sem conex√£o com a internet. Verifique sua conex√£o.';
                    } else {
                        errorText = `Erro desconhecido: ${error.message || error.text || 'Contate o TI'}`;
                    }
                    
                    document.getElementById('errorText').textContent = errorText;
                    
                    // Mostrar formul√°rio novamente
                    document.getElementById('supportForm').style.display = 'block';
                    document.getElementById('submitBtn').disabled = false;
                    
                    // Esconder erro ap√≥s 10 segundos
                    setTimeout(() => {
                        document.getElementById('errorMessage').style.display = 'none';
                    }, 10000);
                });
        });

        // M√°scara para telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 10) {
                value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            }
            e.target.value = value;
        });

        // Remover erros quando o usu√°rio come√ßar a digitar
        document.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('input', function() {
                const fieldId = this.id;
                if (fieldId) {
                    mostrarErroValidacao(fieldId, false);
                }
            });
        });

        // Valida√ß√£o especial para checkboxes
        document.querySelectorAll('input[name="equipamento"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const equipamentos = document.querySelectorAll('input[name="equipamento"]:checked');
                if (equipamentos.length > 0) {
                    document.getElementById('equipamento-error').style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
